<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8] -->
<html lang="en">
  <!-- <![endif] -->
  <head>
  <meta charset="utf-8" />
  <!-- %meta{:content => "IE=edge,chrome=1", "http-equiv" => "X-UA-Compatible"} -->
  <title>10.000 indultos</title>
  <meta content="El indultometro" name="description" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="/favicon.ico" rel="shortcut icon" />
  <link href="/images/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114" />
  <link href="/images/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72" />
  <link href="/images/apple-touch-icon-57x57-precomposed.png" rel="apple-touch-icon-precomposed" />
  <link href="/stylesheets/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/responsive.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/font-awesome.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/theme.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/fonts.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/custom.css" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="theme-pattern-concrete-wall" >
  <!-- Page Header -->
  <header id="masthead">
    <nav class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <h1 class="brand">
            <a href="/index.html">
              El indultómetro
              <i class="icon-legal"></i>
            </a>
          </h1>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              <li class=" active "><a href="/indultos.html">10.000 indultos</a></li>
              <li class=""><a href="/famosos.html">Los más sonados</a></li>
              <li class=""><a href="/noticias.html">Noticias</a></li>
              <li class=""><a href="/ayuda.html">¿Qué es esto?</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
  </header>

<!-- Main Content -->
<div id="content" role="main">
<section class="section alt" id="promo">
  <div class="container">
    <div class="hero-unit">
      <h1>10.000 indultos</h1>
    </div>
  </div>
</section>
<section class="section">
  <div class="container">
    <div class="row-fluid">
      <div class="span12">
        <article class="blog-post">
          <header class="blog-header">
            <h2>
              This is the lead
            </h2>
          </header>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
            tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
            quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
            consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
            cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
            proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
          </p>
          <div class="row-fluid">
            <div class="span10 offset1">
              <form class="pull-left" id="search-form">
                <input type="text" class="span7" id="search-form-query">
                <button type="submit" class="btn">Buscar</button>
              </form>
            </div>
            <div class="span10 offset1">            
              <p>Se firmaron <span id="pardon-count-legend"></span> indultos en el año <span id="pardon-year-legend"></span>.
                Haz click para verlos en detalle.</p>
            </div>
            <div class="span10 offset1" id="summary-viz">
            </div>
            <div class="span10 offset1">
              <small>
                <table class="table table-bordered table-striped" id="indultos">
                  <thead>
                    <tr>
                      <th>Id</th>
                      <th>Fecha</th>
                      <th>Rol</th>
                      <th>Delito</th>
                      <!-- FIXME: Quito Rol, -->
                      <!-- FIXME: Add link to BOE -->
                      <!-- FIXME: Add link to detail page -->
                    </tr>
                  </thead>
                  <tbody>

                  </tbody>
                </table>
              </small>
            </div>
          </div>
        </article>
      </div>
    </div>
  </div>
</section>
</div>

<script type='text/javascript'>
  // http://samsaffron.com/archive/2012/02/17/stop-paying-your-jquery-tax
  window.q=[];window.$=function(f){q.push(f)}
</script>


<!-- // FIXME: Move this to separate file -->
<style>
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}
</style>
<script> 
  $(function() {
    // FIXME: Move this to separate file

    function renderResults(data) {
      $('#indultos tbody').empty();
      var fragments = [];
      $.each(data, function(key, pardon) {
        fragments.push('<tr>');
        $.each(['id', 'pardon_date', 'role', 'crime'], function(i, field_name) {
          fragments.push('<td>');
          fragments.push(pardon[field_name]);
          fragments.push('</td>');
        });
        fragments.push('</tr>');
      });
      $(fragments.join('')).appendTo('#indultos tbody');
    }

    function displayYear(year) {
      $.ajax({
        url: '/api/pardons?callback=?',
        data: {year: year},
        dataType: "jsonp",
        jsonpCallback: "onLoad",
        cache: false  // FIXME: development
      }).success(renderResults);      
    }

    function doSearch(query) {
      $.ajax({
        url: '/api/search',
        data: {q: query},
      }).success(renderResults);      
    }

    function onHover(d) {
      $("#pardon-count-legend").text(d.count);
      $("#pardon-year-legend").text(d.year);
    }

    function onClick(d) {
      displayYear(d.year);
    }

    var margin = {top: 20, right: 20, bottom: 30, left: 60},
        width = 800 - margin.left - margin.right,
        height = 300 - margin.top - margin.bottom;

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left");

    var svg = d3.select("#summary-viz").append("svg")
        .attr("width", '100%')
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.json("/api/summary", function(error, data) {
      if (error) return console.warn(error);

      x.domain(data.map(function(d) { return d.year; }));
      y.domain([0, d3.max(data, function(d) { return d.count; })]);

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
        .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Indultos");

      svg.selectAll(".bar")
          .data(data)
        .enter().append("rect")
          .attr("class", "bar")
          .attr("x", function(d) { return x(d.year); })
          .attr("width", x.rangeBand())
          .attr("y", function(d) { return y(d.count); })
          .on("mouseover", onHover)
          .on("click", onClick)
          .attr("height", function(d) { return height - y(d.count); });
    });

    displayYear('2007');

    $("#search-form").submit(function() {
      doSearch($("#search-form-query").val());
      // FIXME: Update viz with results summary
      return false;
    });
  });
</script>

<!-- Page Footer -->
<footer class="section" id="footer" role="contentinfo">
  <div class="container">
    <div class="row-fluid">
      <div class="span4">
        <h3>Contacta con nosotros</h3>
        <p>
          La Fundación Ciudadana Civio es una organización sin ánimo de lucro...
        </p>
        <ul class="icons">
          <li>
            <i class="icon-envelope"></i>
            <a href="mailto:contacto@civio.es">contacto@civio.es</a>
          </li>
          <li>
            <i class="icon-twitter"></i>
            <a href="http://twitter.com/civio/" target="_blank">@civio</a>
          </li>
          <li>
            <i class="icon-facebook"></i>
            <a href="http://facebook.com/fundacioncivio" target="_blank">Civio</a>
          </li>
        </ul>
      </div>
      <div class="span4">
        <h3>El indultómetro</h3>
        <p>
          Un proyecto de @dcabo y @jjelosua para Civio... Pilla el código aquí...
        </p>
        </ul>
      </div>
      <div class="span4">
        <h3>Noticias</h3>
        <ul class="unstyled">
          
          <li>
            <h4>
              <a href="/2013/01/29/hello-world.html" title="Hello world">Hello world</a>
            </h4>
            <p>
              <small>29 de enero de 2013</small>
            </p>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<script src="/javascripts/jquery.min.js" type="text/javascript"></script>
<script src="/javascripts/bootstrap.js" type="text/javascript"></script>
<script src="/javascripts/script.js" type="text/javascript"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript">$.each(q,function(i,f){$(f)})</script>
<script type="text/javascript">
if (typeof gaJsHost == 'undefined') {
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
}
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("#########");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
